@model CMCS.Web.Services.MonthlyReport
@{
	ViewData["Title"] = "Monthly Reports";
	var monthName = new DateTime(Model.Year, Model.Month, 1).ToString("MMMM yyyy");
}

<div class="row">
	<div class="col-12">
		<div class="d-flex justify-content-between align-items-center mb-4">
			<div>
				<h1 class="mb-1">Monthly Reports</h1>
				<p class="text-muted mb-0">Summary of claims and payments for @monthName</p>
			</div>
			<div>
				<a asp-action="Dashboard" class="btn btn-outline-secondary me-2">‚Üê Back to Dashboard</a>
				<button class="btn btn-primary" onclick="window.print()">
					<i class="bi bi-printer"></i> Print Report
				</button>
			</div>
		</div>

		<!-- Report Period Selector -->
		<div class="card border-0 shadow-sm mb-3">
			<div class="card-body">
				<form asp-action="GenerateReport" method="post" class="row g-3">
					<div class="col-md-4">
						<label class="form-label fw-semibold">Select Month</label>
						<select name="month" class="form-select">
							@for (int i = 1; i <= 12; i++)
							{
								<option value="@i" selected="@(i == Model.Month)">@(new DateTime(2024, i, 1).ToString("MMMM"))</option>
							}
						</select>
					</div>
					<div class="col-md-4">
						<label class="form-label fw-semibold">Select Year</label>
						<select name="year" class="form-select">
							@for (int y = DateTime.UtcNow.Year - 2; y <= DateTime.UtcNow.Year; y++)
							{
								<option value="@y" selected="@(y == Model.Year)">@y</option>
							}
						</select>
					</div>
					<div class="col-md-4">
						<label class="form-label fw-semibold">&nbsp;</label>
						<button type="submit" class="btn btn-primary w-100">Generate Report</button>
					</div>
				</form>
			</div>
		</div>

		<!-- Summary Statistics -->
		<div class="row g-4 mb-4">
			<div class="col-md-3">
				<div class="card border-0 shadow-sm">
					<div class="card-body text-center">
						<h2 class="text-primary mb-2">@Model.TotalClaims</h2>
						<p class="text-muted mb-0">Total Claims</p>
					</div>
				</div>
			</div>
			<div class="col-md-3">
				<div class="card border-0 shadow-sm">
					<div class="card-body text-center">
						<h2 class="text-success mb-2">@Model.ApprovedClaims</h2>
						<p class="text-muted mb-0">Approved Claims</p>
					</div>
				</div>
			</div>
			<div class="col-md-3">
				<div class="card border-0 shadow-sm">
					<div class="card-body text-center">
						<h2 class="text-warning mb-2">@Model.TotalHours.ToString("N0")</h2>
						<p class="text-muted mb-0">Total Hours</p>
					</div>
				</div>
			</div>
			<div class="col-md-3">
				<div class="card border-0 shadow-sm">
					<div class="card-body text-center">
						<h2 class="text-success mb-2">R @Model.NetPayable.ToString("N0")</h2>
						<p class="text-muted mb-0">Net Payable</p>
					</div>
				</div>
			</div>
		</div>

		<!-- Detailed Breakdown -->
		<div class="card border-0 shadow-sm mb-3">
			<div class="card-header bg-white border-bottom">
				<h5 class="card-title mb-0">Claim Status Breakdown</h5>
			</div>
			<div class="card-body">
				<div class="row g-3">
					<div class="col-md-6">
						<div class="list-group">
							<div class="list-group-item d-flex justify-content-between align-items-center">
								<span><i class="bi bi-circle-fill text-primary"></i> Submitted</span>
								<span class="badge bg-primary rounded-pill">@Model.SubmittedClaims</span>
							</div>
							<div class="list-group-item d-flex justify-content-between align-items-center">
								<span><i class="bi bi-circle-fill text-info"></i> Verified</span>
								<span class="badge bg-info rounded-pill">@Model.VerifiedClaims</span>
							</div>
							<div class="list-group-item d-flex justify-content-between align-items-center">
								<span><i class="bi bi-circle-fill text-success"></i> Approved</span>
								<span class="badge bg-success rounded-pill">@Model.ApprovedClaims</span>
							</div>
						</div>
					</div>
					<div class="col-md-6">
						<div class="list-group">
							<div class="list-group-item d-flex justify-content-between align-items-center">
								<span><i class="bi bi-circle-fill text-danger"></i> Rejected</span>
								<span class="badge bg-danger rounded-pill">@Model.RejectedClaims</span>
							</div>
							<div class="list-group-item d-flex justify-content-between align-items-center">
								<span><i class="bi bi-circle-fill text-dark"></i> Settled</span>
								<span class="badge bg-dark rounded-pill">@Model.SettledClaims</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Financial Summary -->
		<div class="card border-0 shadow-sm mb-3">
			<div class="card-header bg-success text-white">
				<h5 class="card-title mb-0">Financial Summary</h5>
			</div>
			<div class="card-body">
				<table class="table table-borderless mb-0">
					<tr>
						<td class="fw-semibold">Total Hours Worked:</td>
						<td class="text-end">@Model.TotalHours.ToString("N2") hours</td>
					</tr>
					<tr>
						<td class="fw-semibold">Gross Amount:</td>
						<td class="text-end">R @Model.TotalAmount.ToString("N2")</td>
					</tr>
					<tr>
						<td class="fw-semibold">Tax Deduction (20%):</td>
						<td class="text-end text-danger">- R @Model.TaxAmount.ToString("N2")</td>
					</tr>
					<tr class="border-top">
						<td class="fw-bold fs-5">Net Payable:</td>
						<td class="text-end fw-bold fs-5 text-success">R @Model.NetPayable.ToString("N2")</td>
					</tr>
				</table>
			</div>
		</div>

		<!-- Approved Claims Details -->
		@if (Model.Claims.Any())
		{
			<div class="card border-0 shadow-sm">
				<div class="card-header bg-white border-bottom">
					<h5 class="card-title mb-0">Approved Claims Details</h5>
				</div>
				<div class="card-body p-0">
					<div class="table-responsive">
						<table class="table table-hover mb-0">
							<thead class="table-light">
								<tr>
									<th>Claim #</th>
									<th>Lecturer ID</th>
									<th class="text-end">Hours</th>
									<th class="text-end">Rate</th>
									<th class="text-end">Gross</th>
									<th class="text-end">Net</th>
									<th class="text-center">Status</th>
								</tr>
							</thead>
							<tbody>
								@foreach (var claim in Model.Claims)
								{
									<tr>
										<td>#@claim.Id</td>
										<td>Lecturer @claim.LecturerId</td>
										<td class="text-end">@claim.TotalHours.ToString("N2")</td>
										<td class="text-end">R @claim.HourlyRate.ToString("N2")</td>
										<td class="text-end">R @claim.Amount.ToString("N2")</td>
										<td class="text-end text-success">R @((claim.Amount * 0.8m).ToString("N2"))</td>
										<td class="text-center">
											<span class="badge bg-success">@claim.Status</span>
										</td>
									</tr>
								}
							</tbody>
						</table>
					</div>
				</div>
			</div>
		}
		else
		{
			<div class="card border-0 shadow-sm">
				<div class="card-body text-center text-muted py-5">
					<h5>No approved claims for this period</h5>
					<p>There are no approved or settled claims for @monthName</p>
				</div>
			</div>
		}

		<div class="mt-3 text-muted small text-center">
			<p class="mb-0">Report generated on @Model.GeneratedDate.ToString("yyyy-MM-dd HH:mm:ss") UTC</p>
		</div>
	</div>
</div>

@section Styles {
	<style media="print">
		.btn, .navbar, footer, nav, form { display: none !important; }
	</style>
}

